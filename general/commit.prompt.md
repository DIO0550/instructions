# コミットルール

## コミットメッセージの書き方

- コミットメッセージは、日本語で書くこと。
- コミットメッセージは、以下のフォーマットに従うこと。

\<type>: \<subject>  
\<type>は、以下の以下のフォーマットに従うこと
|タイプ|フォーマット|
|:-|:-|
|最初のコミット（Initial Commit） |🎉 [Initial Commit]:|
|新機能（New Feature） |✨ [New Feature]:|
|バグ修正（Bugfix） |🐛 [Bug fix]: |
|リファクタリング(Refactoring) |♻️ [Refactaoring]:|
|デザイン UI/UX(Accessibility) |🎨 [Accessibility]:|
|パフォーマンス（Performance） |🐎 [Performance]:|
|テスト（Tests） |🚨 [Tests]:|
|削除（Removal） |🗑️ [Remove]:|
|チャットログやドキュメントの更新(Doc)|📖 [Doc]:|
|WIP(Work In Progress) |🚧 [WIP]:|

## コミットの分割ルール

### 基本方針：細かくコミットを分割する

- **一つのコミットには一つの最小単位の変更のみを含める**
- **変更が小さすぎても構わない。大きなコミットよりも小さなコミットを優先する**

### 必須の分割ケース

以下の場合は、必ずコミットを分割すること：

- 複数の機能を同時に実装した場合
- バグ修正と新機能を同時に行った場合
- リファクタリングと機能追加を同時に行った場合
- 複数のファイルで異なる目的の変更を行った場合
- テストコードの追加と実装コードの変更を同時に行った場合
- ドキュメントの更新と機能実装を同時に行った場合

### 推奨される細分化

以下のような場合も積極的に分割することを推奨：

- 一つの機能でも、準備段階と実装段階に分けられる場合
- インターフェース定義と実装を分ける場合
- 型定義の追加と利用を分ける場合
- 設定ファイルの変更と機能実装を分ける場合
- 依存関係の追加と利用を分ける場合

### コミットの粒度の目安

- **最小単位**：一つの関数、一つのコンポーネント、一つの設定変更
- **変更行数**：可能な限り少なく（目安：50 行以下）
- **変更時間**：5-15 分程度で完了する作業単位
- **理解しやすさ**：コミットメッセージだけで変更内容が完全に理解できる
- **独立性**：そのコミット単体で意味をなす変更
- **ビルド状態**：各コミットでビルドが通る状態を維持する

## 禁止

## **禁止事項**

- 以下のように、すべての変更をステージングに移動するコマンドは使用禁止とする
  - `git add .`
  - `git add --all`
  - `git add -A`

### 意味が伝わらないコミットメッセージの禁止

以下のような「何を・なぜ」変更したかが第三者から判別できない曖昧/抽象的/使い回しのフレーズのみで構成された subject は使用禁止とする。

NG 例（単体またはこれらだけの組合せは不可）:

- 修正 / ちょっと修正 / 細かい修正 / 微調整
- 対応 / 対応しました / レビュー指摘対応 / 指摘対応 / PR 指摘反映
- リファクタ / リファクタリングのみ（対象が不明瞭な場合）
- 調整 / 更新 / 変更 / 追加 だけ
- fix / update / change / modify だけ
- WIP（暫定コミットを残す必要がある場合は必ず具体的内容を併記し、可能なら squash）

良い書き方の指針:

1. 何を(対象) 2. どうした(操作) 3. なぜ(目的/意図) の順で最小限具体化する。
2. 「なぜ」を 1 フレーズで補足できない場合は本文(空行後)に詳細を書く。
3. issue や チケット ID がある場合は本文に `Refs: #123` 等で関連付ける。

書き換え例:

- NG: `✨ [New Feature]: 機能追加`
  - OK: `✨ [New Feature]: ユーザ検索にロール絞り込みフィルタを追加` (目的: 絞り込み性能と UX 向上)
- NG: `🐛 [Bug fix]: 修正`
  - OK: `🐛 [Bug fix]: Firefox 環境でのプロフィール画像アップロード失敗を FormData の boundary 設定漏れで修正`
- NG: `♻️ [Refactaoring]: リファクタ`
  - OK: `♻️ [Refactaoring]: userService の重複バリデーション処理を validateUser() に集約しテスト追加`
- NG: `📖 [Doc]: README 更新`
  - OK: `📖 [Doc]: 開発環境セットアップ手順に Node 20 要件とキャッシュクリア手順を追記`

補足:

- 定型句に陥りそうなら PR 作成前に `git log --oneline` を俯瞰し、同質な曖昧語が並んでいないか確認する。
- それでも迷った場合は「このコミットを revert する判断を、ログだけ見て 30 秒でできるか?」を基準に再記述する。
